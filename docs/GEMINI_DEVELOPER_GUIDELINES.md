# Gemini 開發指南 (GEMINI_DEVELOPER_GUIDELINES.md)

## 1. 總體原則

本文件旨在指導 Gemini 在 Bitfinex Lending Bot 專案中的開發行為。請嚴格遵守以下核心原則：

*   **專案慣例優先：** 始終優先遵循專案中現有的程式碼風格、命名約定、模組結構和錯誤處理模式。在進行任何修改前，請仔細分析周圍的程式碼。
*   **模組化與可測試性：** 鼓勵將複雜功能拆分為獨立、可測試的單元。`src/test/` 中的測試模式應作為新測試的參考。
*   **安全與驗證：** 任何修改都必須經過驗證。這包括運行相關的單元測試、執行專案的 Linting 和型別檢查。在執行任何可能修改系統或程式碼的 shell 命令前，清晰地解釋其目的和潛在影響。
*   **用戶確認：** 在執行任何重大操作（特別是涉及真實 API 交易或文件系統修改）之前，務必向用戶確認。
*   **精簡與直接：** 溝通應簡潔、直接，避免冗餘的寒暄。輸出應盡量精簡，聚焦於核心資訊。

## 2. 開發工作流程

當處理用戶請求時，請遵循以下步驟：

### 2.1 理解 (Understand)

*   **全面分析：** 使用 `read_file`、`read_many_files`、`glob` 和 `search_file_content` 工具，深入理解用戶請求的上下文、相關文件、現有程式碼模式和專案結構。
*   **識別依賴：** 檢查 `requirements.txt` 以確認現有函式庫的使用情況。除非專案中已有明確使用，否則不要假設任何函式庫可用。

### 2.2 規劃 (Plan)

*   **制定清晰計畫：** 根據理解階段的分析，制定一個具體、可行的實施計畫。計畫應考慮到對現有程式碼的影響，並盡量減少不必要的變動。
*   **測試先行：** 如果適用，考慮為新功能或修改的邏輯編寫單元測試，以建立安全網。

### 2.3 實施 (Implement)

*   **使用工具：** 優先使用 `replace`、`write_file` 和 `run_shell_command` 等工具來執行程式碼修改和文件操作。
*   **程式碼風格：** 嚴格遵循現有的 Python 程式碼風格（例如，變數命名、函數簽名、縮排）。
*   **註釋：** 僅在必要時添加高價值的註釋，解釋「為什麼」這樣做，而不是「做了什麼」。
*   **錯誤處理：** 模仿專案中現有的 `try-except` 模式。

### 2.4 驗證 (Verify)

*   **運行測試：** 在修改程式碼後，使用 `python tools/run_all_tests.py` 運行相關測試，確保修改沒有引入迴歸。
*   **執行程式碼品質檢查：**
    *   **Linting:** 運行 `ruff check .` 以檢查程式碼風格和潛在錯誤。
    *   **型別檢查:** 運行 `mypy .` 以檢查型別一致性。
    *   如果這些工具未配置或不確定命令，請向用戶詢問。

## 3. 核心規則

### 3.1 禁止事項 (PROHIBITIONS)

*   **絕不** 修改 `.env` 等環境設定檔案。
*   **絕不** 在根目錄下創建新文件，應使用適當的模組結構。
*   **絕不** 將輸出文件直接寫入根目錄，應使用 `output/` 文件夾。
*   **絕不** 創建重複功能的腳本（例如 `manager_v2.py`），應擴展現有文件。
*   **絕不** 複製貼上程式碼塊，應提取為共享工具/函數。
*   **絕不** 硬編碼應可配置的值，應使用配置文件。
*   **絕不** 使用 `find`、`grep`、`cat`、`ls` 等原生 shell 命令，應使用 Gemini 的內建工具。

### 3.2 強制要求 (MANDATORY)

*   **編輯前先讀取 (READ FIRST, EDIT LATER):** 在編輯文件前，必須先使用 `read_file` 或 `read_many_files` 讀取其內容。
*   **單一事實來源 (SINGLE SOURCE OF TRUTH):** 每個功能/概念只應有一個權威實現。
*   **技術債預防 (DEBT PREVENTION):** 在創建新文件之前，先使用 `glob` 或 `search_file_content` 檢查是否存在類似功能可供擴展。
*   **提交變更:** 在完成一個階段性任務後，主動提議 `git commit`。

## 4. Git 工作流程

*   **檢查狀態：** 提交前，運行 `git status`、`git diff HEAD` 和 `git log -n 3` 以了解倉庫狀態、變更內容和提交歷史。
*   **提出提交訊息：** 始終提出一個清晰、簡潔且聚焦於「為什麼」的提交訊息草稿。
*   **確認成功：** 每次提交後，運行 `git status` 確認提交成功。
*   **不推送：** 未經用戶明確要求，絕不將更改推送到遠端倉庫。
